(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var _game = require('./game.js');

var canvas = document.getElementById('screen');
var game = new _game.Game(canvas);

var masterLoop = function (timestamp) {
  game.loop(timestamp);
  window.requestAnimationFrame(masterLoop);
};
masterLoop(performance.now());

},{"./game.js":5}],2:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.Astroid = undefined;

var _actor = require("./common/actor");

class Astroid extends _actor.Actor {
    constructor(world, { x, y, r, dx, dy, dr, scale }) {
        super(world);
        this.x = x;
        this.y = y;
        this.rot = r;

        this.dx = dx;
        this.dy = dy;
        this.drot = dr;

        this.points = [{ x: 1, y: 12 }, { x: -10, y: 8 }, { x: -16, y: -2 }, { x: -4, y: -10 }, { x: 8, y: -10 }, { x: 12, y: 0 }];
        this.scale = scale;
    }

    *baseControlState() {
        while (true) {
            let { dt } = yield;
            this.rot += this.drot;
            this.x += this.dx;
            this.y += this.dy;

            let on_screen_x = 0;
            let on_screen_y = 0;
            for (let { x, y } of this.points) {
                x = this.x + x * this.scale;
                y = this.y + y * this.scale;
                // console.log(x, y)
                on_screen_x |= (x > 0 && x < this.world.width) | 0;
                on_screen_y |= (y > 0 && y < this.world.height) | 0;
            }
            if (!on_screen_x) {
                if (this.x < 0 && this.dx < 0 || this.x > this.world.width && this.dx > 0) {
                    this.x = this.world.width - this.x;
                }
            }
            if (!on_screen_y) {
                if (this.y < 0 && this.dy < 0 || this.y > this.world.height && this.dy > 0) {
                    this.y = this.world.height - this.y;
                }
            }
        }
    }

    *baseRenderState() {
        while (true) {
            let { ctx, dt } = yield;
            let points = rotate(this.rot, this.points);
            ctx.beginPath();
            ctx.lineWidth = "2";
            ctx.strokeStyle = "grey";
            ctx.moveTo(this.x, this.y);
            for (let { x, y } of points) {
                ctx.lineTo(this.x + x * this.scale, this.y + y * this.scale);
            }
            ctx.lineTo(this.x, this.y);
            ctx.stroke();
            ctx.fillStyle = 'yellow';
            ctx.fillRect(this.x, this.y, 2, 2);
        }
    }
}

exports.Astroid = Astroid;
function rotate(rot, points) {
    let result = [];
    let sin = Math.sin(rot);
    let cos = Math.cos(rot);

    for (let { x, y } of points) {
        result.push({
            x: x * cos - y * sin,
            y: x * sin + y * cos
        });
    }
    return result;
}

},{"./common/actor":3}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.Actor = undefined;

var _events = require("./events.js");

class Actor {
    constructor(world) {
        this.events = new _events.EventListener();

        this.world = world;
        this.x = 0;
        this.y = 0;
        this.width = 64;
        this.height = 64;

        this.controlState = this.baseControlState.bind(this)();
        this.renderState = this.baseRenderState.bind(this)();
    }

    getHitBoxes() {
        return [];
    }

    collect() {
        return false;
    }

    update(dt) {
        let cur = this.controlState.next({ dt: dt });
        if (cur.value != null) {
            this.controlState = cur.value;
        } else if (cur.done) {
            this.controlState = this.baseControlState.bind(this)();
        }
    }

    render(dt, ctx) {
        let cur = this.renderState.next({ dt: dt, ctx: ctx });
        if (cur.value != null) {
            this.renderState = cur.value;
        } else if (cur.done) {
            this.renderState = this.baseRenderState.bind(this)();
        }
    }

    *baseControlState() {}
    *baseRenderState() {}
}
exports.Actor = Actor;

},{"./events.js":4}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
class EventListener {
    constructor() {
        this.events = {};
    }

    addEventListener(name, func) {
        let events = this.events[name] || [];
        this.events[name] = events;

        events.push(func);
    }

    emit(name, args) {
        let events = this.events[name] || [];
        for (let ev of events) {
            ev(args);
        }
    }
}
exports.EventListener = EventListener;

},{}],5:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.Game = undefined;

var _astroid = require('./astroid');

const Player = require('./player.js');

class Game {
    constructor(screen) {

        // Set up buffers
        this.frontBuffer = screen;
        this.frontCtx = screen.getContext('2d');
        this.backBuffer = document.createElement('canvas');
        this.backBuffer.width = screen.width;
        this.backBuffer.height = screen.height;
        this.backCtx = this.backBuffer.getContext('2d');

        this.width = screen.width;
        this.height = screen.height;

        // Start the game loop
        this.oldTime = performance.now();
        this.paused = false;

        this.astroids = [new _astroid.Astroid(this, { x: 300, y: 300, r: 0, dx: -1, dy: 1, dr: .1, scale: 2 }), new _astroid.Astroid(this, { x: 30, y: 300, r: 0, dx: 1, dy: -1, dr: .1, scale: 3 })];
        this.player = new Player({ x: this.backBuffer.width / 2, y: this.backBuffer.height / 2 }, this.backBuffer);
    }

    pause(flag) {
        this.paused = flag == true;
    }

    loop(newTime) {
        var game = this;
        var elapsedTime = newTime - this.oldTime;
        this.oldTime = newTime;

        if (!this.paused) this.update(elapsedTime);
        this.render(elapsedTime, this.backCtx);
        this.frontCtx.drawImage(this.backBuffer, 0, 0);
    }

    update(elapsedTime) {
        this.player.update(elapsedTime);
        for (let astroid of this.astroids) {
            astroid.update(elapsedTime);
        }
        // TODO: Update the game objects
    }

    render(elapsedTime, ctx) {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, this.backBuffer.width, this.backBuffer.height);
        this.player.render(elapsedTime, ctx);

        for (let astroid of this.astroids) {
            astroid.render(elapsedTime, ctx);
        }
    }
}
exports.Game = Game;

},{"./astroid":2,"./player.js":6}],6:[function(require,module,exports){
"use strict";

const MS_PER_FRAME = 1000 / 8;

module.exports = exports = Player;

function Player(position, canvas) {
  this.worldWidth = canvas.width;
  this.worldHeight = canvas.height;
  this.state = "idle";
  this.position = {
    x: position.x,
    y: position.y
  };
  this.velocity = {
    x: 0,
    y: 0
  };
  this.angle = 0;
  this.radius = 64;
  this.thrusting = false;
  this.steerLeft = false;
  this.steerRight = false;

  var self = this;
  window.onkeydown = function (event) {
    switch (event.key) {
      case 'ArrowUp': // up
      case 'w':
        self.thrusting = true;
        break;
      case 'ArrowLeft': // left
      case 'a':
        self.steerLeft = true;
        break;
      case 'ArrowRight': // right
      case 'd':
        self.steerRight = true;
        break;
    }
  };

  window.onkeyup = function (event) {
    switch (event.key) {
      case 'ArrowUp': // up
      case 'w':
        self.thrusting = false;
        break;
      case 'ArrowLeft': // left
      case 'a':
        self.steerLeft = false;
        break;
      case 'ArrowRight': // right
      case 'd':
        self.steerRight = false;
        break;
    }
  };
}

Player.prototype.update = function (time) {
  // Apply angular velocity
  if (this.steerLeft) {
    this.angle += time * 0.005;
  }
  if (this.steerRight) {
    this.angle -= 0.1;
  }
  // Apply acceleration
  if (this.thrusting) {
    var acceleration = {
      x: Math.sin(this.angle),
      y: Math.cos(this.angle)
    };
    this.velocity.x -= acceleration.x;
    this.velocity.y -= acceleration.y;
  }
  // Apply velocity
  this.position.x += this.velocity.x;
  this.position.y += this.velocity.y;
  // Wrap around the screen
  if (this.position.x < 0) this.position.x += this.worldWidth;
  if (this.position.x > this.worldWidth) this.position.x -= this.worldWidth;
  if (this.position.y < 0) this.position.y += this.worldHeight;
  if (this.position.y > this.worldHeight) this.position.y -= this.worldHeight;
};

Player.prototype.render = function (time, ctx) {
  ctx.save();

  // Draw player's ship
  ctx.translate(this.position.x, this.position.y);
  ctx.rotate(-this.angle);
  ctx.beginPath();
  ctx.moveTo(0, -10);
  ctx.lineTo(-10, 10);
  ctx.lineTo(0, 0);
  ctx.lineTo(10, 10);
  ctx.closePath();
  ctx.strokeStyle = 'white';
  ctx.stroke();

  // Draw engine thrust
  if (this.thrusting) {
    ctx.beginPath();
    ctx.moveTo(0, 20);
    ctx.lineTo(5, 10);
    ctx.arc(0, 10, 5, 0, Math.PI, true);
    ctx.closePath();
    ctx.strokeStyle = 'orange';
    ctx.stroke();
  }
  ctx.restore();
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIiwic3JjL2FzdHJvaWQuanMiLCJzcmMvY29tbW9uL2FjdG9yLmpzIiwic3JjL2NvbW1vbi9ldmVudHMuanMiLCJzcmMvZ2FtZS5qcyIsInNyYy9wbGF5ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTs7QUFFQTs7QUFFQSxJQUFJLFNBQVMsU0FBUyxjQUFULENBQXdCLFFBQXhCLENBQWI7QUFDQSxJQUFJLE9BQU8sZUFBUyxNQUFULENBQVg7O0FBRUEsSUFBSSxhQUFhLFVBQVMsU0FBVCxFQUFvQjtBQUNuQyxPQUFLLElBQUwsQ0FBVSxTQUFWO0FBQ0EsU0FBTyxxQkFBUCxDQUE2QixVQUE3QjtBQUNELENBSEQ7QUFJQSxXQUFXLFlBQVksR0FBWixFQUFYOzs7Ozs7Ozs7O0FDWEE7O0FBRU8sTUFBTSxPQUFOLHNCQUE0QjtBQUMvQixnQkFBWSxLQUFaLEVBQW1CLEVBQUMsQ0FBRCxFQUFJLENBQUosRUFBTyxDQUFQLEVBQVUsRUFBVixFQUFjLEVBQWQsRUFBa0IsRUFBbEIsRUFBc0IsS0FBdEIsRUFBbkIsRUFBaUQ7QUFDN0MsY0FBTSxLQUFOO0FBQ0EsYUFBSyxDQUFMLEdBQVMsQ0FBVDtBQUNBLGFBQUssQ0FBTCxHQUFTLENBQVQ7QUFDQSxhQUFLLEdBQUwsR0FBVyxDQUFYOztBQUVBLGFBQUssRUFBTCxHQUFVLEVBQVY7QUFDQSxhQUFLLEVBQUwsR0FBVSxFQUFWO0FBQ0EsYUFBSyxJQUFMLEdBQVksRUFBWjs7QUFFQSxhQUFLLE1BQUwsR0FBYyxDQUNWLEVBQUMsR0FBRyxDQUFKLEVBQU8sR0FBRyxFQUFWLEVBRFUsRUFFVixFQUFDLEdBQUcsQ0FBQyxFQUFMLEVBQVMsR0FBRyxDQUFaLEVBRlUsRUFHVixFQUFDLEdBQUcsQ0FBQyxFQUFMLEVBQVMsR0FBRyxDQUFDLENBQWIsRUFIVSxFQUlWLEVBQUMsR0FBRyxDQUFDLENBQUwsRUFB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eEI7QUFDeEMsQ0F6QkQ7O0FBMkJBLE9BQU8sU0FBUCxDQUFpQixNQUFqQixHQUEwQixVQUFTLElBQVQsRUFBZSxHQUFmLEVBQW9CO0FBQzVDLE1BQUksSUFBSjs7QUFFQTtBQUNBLE1BQUksU0FBSixDQUFjLEtBQUssUUFBTCxDQUFjLENBQTVCLEVBQStCLEtBQUssUUFBTCxDQUFjLENBQTdDO0FBQ0EsTUFBSSxNQUFKLENBQVcsQ0FBQyxLQUFLLEtBQWpCO0FBQ0EsTUFBSSxTQUFKO0FBQ0EsTUFBSSxNQUFKLENBQVcsQ0FBWCxFQUFjLENBQUMsRUFBZjtBQUNBLE1BQUksTUFBSixDQUFXLENBQUMsRUFBWixFQUFnQixFQUFoQjtBQUNBLE1BQUksTUFBSixDQUFXLENBQVgsRUFBYyxDQUFkO0FBQ0EsTUFBSSxNQUFKLENBQVcsRUFBWCxFQUFlLEVBQWY7QUFDQSxNQUFJLFNBQUo7QUFDQSxNQUFJLFdBQUosR0FBa0IsT0FBbEI7QUFDQSxNQUFJLE1BQUo7O0FBRUE7QUFDQSxNQUFHLEtBQUssU0FBUixFQUFtQjtBQUNqQixRQUFJLFNBQUo7QUFDQSxRQUFJLE1BQUosQ0FBVyxDQUFYLEVBQWMsRUFBZDtBQUNBLFFBQUksTUFBSixDQUFXLENBQVgsRUFBYyxFQUFkO0FBQ0EsUUFBSSxHQUFKLENBQVEsQ0FBUixFQUFXLEVBQVgsRUFBZSxDQUFmLEVBQWtCLENBQWxCLEVBQXFCLEtBQUssRUFBMUIsRUFBOEIsSUFBOUI7QUFDQSxRQUFJLFNBQUo7QUFDQSxRQUFJLFdBQUosR0FBa0IsUUFBbEI7QUFDQSxRQUFJLE1BQUo7QUFDRDtBQUNELE1BQUksT0FBSjtBQUNELENBMUJEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQge0dhbWV9IGZyb20gJy4vZ2FtZS5qcydcblxudmFyIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JlZW4nKTtcbnZhciBnYW1lID0gbmV3IEdhbWUoY2FudmFzKTtcblxudmFyIG1hc3Rlckxvb3AgPSBmdW5jdGlvbih0aW1lc3RhbXApIHtcbiAgZ2FtZS5sb29wKHRpbWVzdGFtcCk7XG4gIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUobWFzdGVyTG9vcCk7XG59XG5tYXN0ZXJMb29wKHBlcmZvcm1hbmNlLm5vdygpKTtcbiIsImltcG9ydCB7QWN0b3J9IGZyb20gJy4vY29tbW9uL2FjdG9yJ1xuXG5leHBvcnQgY2xhc3MgQXN0cm9pZCBleHRlbmRzIEFjdG9yIHtcbiAgICBjb25zdHJ1Y3Rvcih3b3JsZCwge3gsIHksIHIsIGR4LCBkeSwgZHIsIHNjYWxlfSkge1xuICAgICAgICBzdXBlcih3b3JsZClcbiAgICAgICAgdGhpcy54ID0geFxuICAgICAgICB0aGlzLnkgPSB5XG4gICAgICAgIHRoaXMucm90ID0gclxuXG4gICAgICAgIHRoaXMuZHggPSBkeFxuICAgICAgICB0aGlzLmR5ID0gZHlcbiAgICAgICAgdGhpcy5kcm90ID0gZHJcblxuICAgICAgICB0aGlzLnBvaW50cyA9IFtcbiAgICAgICAgICAgIHt4OiAxLCB5OiAxMn0sXG4gICAgICAgICAgICB7eDogLTEwLCB5OiA4fSxcbiAgICAgICAgICAgIHt4OiAtMTYsIHk6IC0yfSxcbiAgICAgICAgICAgIHt4OiAtNCwgeTogLTEwfSxcbiAgICAgICAgICAgIHt4OiA4LCB5OiAtMTB9LFxuICAgICAgICAgICAge3g6IDEyLCB5OiAwfSxcbiAgICAgICAgXVxuICAgICAgICB0aGlzLnNjYWxlID0gc2NhbGVcbiAgICB9XG5cbiAgICAqYmFzZUNvbnRyb2xTdGF0ZSgpIHtcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgIGxldCB7ZHR9ID0geWllbGRcbiAgICAgICAgICAgIHRoaXMucm90ICs9IHRoaXMuZHJvdFxuICAgICAgICAgICAgdGhpcy54ICs9IHRoaXMuZHhcbiAgICAgICAgICAgIHRoaXMueSArPSB0aGlzLmR5XG5cbiAgICAgICAgICAgIGxldCBvbl9zY3JlZW5feCA9IDBcbiAgICAgICAgICAgIGxldCBvbl9zY3JlZW5feSA9IDBcbiAgICAgICAgICAgIGZvciAobGV0IHt4LCB5fSBvZiB0aGlzLnBvaW50cykge1xuICAgICAgICAgICAgICAgIHggPSB0aGlzLnggKyB4KnRoaXMuc2NhbGVcbiAgICAgICAgICAgICAgICB5ID0gdGhpcy55ICsgeSp0aGlzLnNjYWxlXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coeCwgeSlcbiAgICAgICAgICAgICAgICBvbl9zY3JlZW5feCB8PSAoeCA+IDAgJiYgeCA8IHRoaXMud29ybGQud2lkdGgpfDBcbiAgICAgICAgICAgICAgICBvbl9zY3JlZW5feSB8PSAoeSA+IDAgJiYgeSA8IHRoaXMud29ybGQuaGVpZ2h0KXwwXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIW9uX3NjcmVlbl94KSB7XG4gICAgICAgICAgICAgICAgaWYgKCh0aGlzLnggPCAwICYmIHRoaXMuZHggPCAwKSB8fCAodGhpcy54ID4gdGhpcy53b3JsZC53aWR0aCAmJiB0aGlzLmR4ID4gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gdGhpcy53b3JsZC53aWR0aCAtIHRoaXMueFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghb25fc2NyZWVuX3kpIHtcbiAgICAgICAgICAgICAgICBpZiAoKHRoaXMueSA8IDAgJiYgdGhpcy5keSA8IDApIHx8ICh0aGlzLnkgPiB0aGlzLndvcmxkLmhlaWdodCAmJiB0aGlzLmR5ID4gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ID0gdGhpcy53b3JsZC5oZWlnaHQgLSB0aGlzLnlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAqYmFzZVJlbmRlclN0YXRlKCkge1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgbGV0IHtjdHgsIGR0fSA9IHlpZWxkXG4gICAgICAgICAgICBsZXQgcG9pbnRzID0gcm90YXRlKHRoaXMucm90LCB0aGlzLnBvaW50cylcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKVxuICAgICAgICAgICAgY3R4LmxpbmVXaWR0aD1cIjJcIlxuICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlPVwiZ3JleVwiXG4gICAgICAgICAgICBjdHgubW92ZVRvKHRoaXMueCwgdGhpcy55KVxuICAgICAgICAgICAgZm9yIChsZXQge3gsIHl9IG9mIHBvaW50cykge1xuICAgICAgICAgICAgICAgIGN0eC5saW5lVG8odGhpcy54K3gqdGhpcy5zY2FsZSwgdGhpcy55K3kqdGhpcy5zY2FsZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN0eC5saW5lVG8odGhpcy54LCB0aGlzLnkpXG4gICAgICAgICAgICBjdHguc3Ryb2tlKClcbiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAneWVsbG93J1xuICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHRoaXMueCwgdGhpcy55LCAyLCAyKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiByb3RhdGUocm90LCBwb2ludHMpIHtcbiAgICBsZXQgcmVzdWx0ID0gW11cbiAgICBsZXQgc2luID0gTWF0aC5zaW4ocm90KVxuICAgIGxldCBjb3MgPSBNYXRoLmNvcyhyb3QpXG5cbiAgICBmb3IgKGxldCB7eCwgeX0gb2YgcG9pbnRzKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgIHg6IHgqY29zIC0geSpzaW4sXG4gICAgICAgICAgICB5OiB4KnNpbiArIHkqY29zLFxuICAgICAgICB9KVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0XG59XG4iLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHtFdmVudExpc3RlbmVyfSBmcm9tIFwiLi9ldmVudHMuanNcIjtcblxuXG5leHBvcnQgY2xhc3MgQWN0b3Ige1xuICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7XG4gICAgICAgIHRoaXMuZXZlbnRzID0gbmV3IEV2ZW50TGlzdGVuZXIoKTtcblxuICAgICAgICB0aGlzLndvcmxkID0gd29ybGQ7XG4gICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIHRoaXMud2lkdGggPSA2NDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSA2NDtcblxuICAgICAgICB0aGlzLmNvbnRyb2xTdGF0ZSA9IHRoaXMuYmFzZUNvbnRyb2xTdGF0ZS5iaW5kKHRoaXMpKCk7XG4gICAgICAgIHRoaXMucmVuZGVyU3RhdGUgPSB0aGlzLmJhc2VSZW5kZXJTdGF0ZS5iaW5kKHRoaXMpKCk7XG4gICAgfVxuXG4gICAgZ2V0SGl0Qm94ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb2xsZWN0KCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIGxldCBjdXIgPSB0aGlzLmNvbnRyb2xTdGF0ZS5uZXh0KHtkdDogZHR9KTtcbiAgICAgICAgaWYgKGN1ci52YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xTdGF0ZSA9IGN1ci52YWx1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChjdXIuZG9uZSkge1xuICAgICAgICAgICAgdGhpcy5jb250cm9sU3RhdGUgPSB0aGlzLmJhc2VDb250cm9sU3RhdGUuYmluZCh0aGlzKSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVuZGVyKGR0LCBjdHgpIHtcbiAgICAgICAgbGV0IGN1ciA9IHRoaXMucmVuZGVyU3RhdGUubmV4dCh7ZHQ6IGR0LCBjdHg6IGN0eH0pO1xuICAgICAgICBpZiAoY3VyLnZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyU3RhdGUgPSBjdXIudmFsdWU7XG4gICAgICAgIH0gZWxzZSBpZiAoY3VyLmRvbmUpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyU3RhdGUgPSB0aGlzLmJhc2VSZW5kZXJTdGF0ZS5iaW5kKHRoaXMpKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAqYmFzZUNvbnRyb2xTdGF0ZSAoKSB7fVxuICAgICpiYXNlUmVuZGVyU3RhdGUgKCkge31cbn1cbiIsIlwidXNlIHN0cmljdFwiO1xuXG5cbmV4cG9ydCBjbGFzcyBFdmVudExpc3RlbmVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5ldmVudHMgPSB7fTtcbiAgICB9XG5cbiAgICBhZGRFdmVudExpc3RlbmVyKG5hbWUsIGZ1bmMpIHtcbiAgICAgICAgbGV0IGV2ZW50cyA9IHRoaXMuZXZlbnRzW25hbWVdIHx8IFtdO1xuICAgICAgICB0aGlzLmV2ZW50c1tuYW1lXSA9IGV2ZW50cztcblxuICAgICAgICBldmVudHMucHVzaChmdW5jKTtcbiAgICB9XG5cbiAgICBlbWl0KG5hbWUsIGFyZ3MpIHtcbiAgICAgICAgbGV0IGV2ZW50cyA9IHRoaXMuZXZlbnRzW25hbWVdIHx8IFtdO1xuICAgICAgICBmb3IgKGxldCBldiBvZiBldmVudHMpIHtcbiAgICAgICAgICAgIGV2KGFyZ3MpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7QXN0cm9pZH0gZnJvbSAnLi9hc3Ryb2lkJ1xuY29uc3QgUGxheWVyID0gcmVxdWlyZSgnLi9wbGF5ZXIuanMnKTtcblxuZXhwb3J0IGNsYXNzIEdhbWUge1xuICAgIGNvbnN0cnVjdG9yKHNjcmVlbikge1xuXG4gICAgICAgIC8vIFNldCB1cCBidWZmZXJzXG4gICAgICAgIHRoaXMuZnJvbnRCdWZmZXIgPSBzY3JlZW47XG4gICAgICAgIHRoaXMuZnJvbnRDdHggPSBzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdGhpcy5iYWNrQnVmZmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgIHRoaXMuYmFja0J1ZmZlci53aWR0aCA9IHNjcmVlbi53aWR0aDtcbiAgICAgICAgdGhpcy5iYWNrQnVmZmVyLmhlaWdodCA9IHNjcmVlbi5oZWlnaHQ7XG4gICAgICAgIHRoaXMuYmFja0N0eCA9IHRoaXMuYmFja0J1ZmZlci5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgICAgIHRoaXMud2lkdGggPSBzY3JlZW4ud2lkdGhcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBzY3JlZW4uaGVpZ2h0XG5cbiAgICAgICAgLy8gU3RhcnQgdGhlIGdhbWUgbG9vcFxuICAgICAgICB0aGlzLm9sZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLmFzdHJvaWRzID0gW1xuICAgICAgICAgICAgbmV3IEFzdHJvaWQodGhpcywge3g6MzAwLCB5OjMwMCwgcjowLCBkeDotMSwgZHk6MSwgZHI6LjEsIHNjYWxlOiAyfSksXG4gICAgICAgICAgICBuZXcgQXN0cm9pZCh0aGlzLCB7eDozMCwgeTozMDAsIHI6MCwgZHg6MSwgZHk6LTEsIGRyOi4xLCBzY2FsZTogM30pLFxuICAgICAgICBdXG4gICAgICAgIHRoaXMucGxheWVyID0gbmV3IFBsYXllcih7eDogdGhpcy5iYWNrQnVmZmVyLndpZHRoLzIsIHk6IHRoaXMuYmFja0J1ZmZlci5oZWlnaHQvMn0sIHRoaXMuYmFja0J1ZmZlcik7XG4gICAgfVxuXG4gICAgcGF1c2UoZmxhZykge1xuICAgICAgICB0aGlzLnBhdXNlZCA9IChmbGFnID09IHRydWUpO1xuICAgIH1cblxuICAgIGxvb3AobmV3VGltZSkge1xuICAgICAgICB2YXIgZ2FtZSA9IHRoaXM7XG4gICAgICAgIHZhciBlbGFwc2VkVGltZSA9IG5ld1RpbWUgLSB0aGlzLm9sZFRpbWU7XG4gICAgICAgIHRoaXMub2xkVGltZSA9IG5ld1RpbWU7XG5cbiAgICAgICAgaWYoIXRoaXMucGF1c2VkKSB0aGlzLnVwZGF0ZShlbGFwc2VkVGltZSk7XG4gICAgICAgIHRoaXMucmVuZGVyKGVsYXBzZWRUaW1lLCB0aGlzLmJhY2tDdHgpO1xuICAgICAgICB0aGlzLmZyb250Q3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tCdWZmZXIsIDAsIDApO1xuICAgIH1cblxuXG4gICAgdXBkYXRlKGVsYXBzZWRUaW1lKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnVwZGF0ZShlbGFwc2VkVGltZSk7XG4gICAgICAgIGZvciAobGV0IGFzdHJvaWQgb2YgdGhpcy5hc3Ryb2lkcykge1xuICAgICAgICAgICAgYXN0cm9pZC51cGRhdGUoZWxhcHNlZFRpbWUpXG4gICAgICAgIH1cbiAgICAgICAgLy8gVE9ETzogVXBkYXRlIHRoZSBnYW1lIG9iamVjdHNcbiAgICB9XG5cbiAgICByZW5kZXIoZWxhcHNlZFRpbWUsIGN0eCkge1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJibGFja1wiO1xuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgdGhpcy5iYWNrQnVmZmVyLndpZHRoLCB0aGlzLmJhY2tCdWZmZXIuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5wbGF5ZXIucmVuZGVyKGVsYXBzZWRUaW1lLCBjdHgpO1xuXG4gICAgICAgIGZvciAobGV0IGFzdHJvaWQgb2YgdGhpcy5hc3Ryb2lkcykge1xuICAgICAgICAgICAgYXN0cm9pZC5yZW5kZXIoZWxhcHNlZFRpbWUsIGN0eClcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsIlwidXNlIHN0cmljdFwiO1xuXG5jb25zdCBNU19QRVJfRlJBTUUgPSAxMDAwLzg7XG5cbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IFBsYXllcjtcblxuZnVuY3Rpb24gUGxheWVyKHBvc2l0aW9uLCBjYW52YXMpIHtcbiAgdGhpcy53b3JsZFdpZHRoID0gY2FudmFzLndpZHRoO1xuICB0aGlzLndvcmxkSGVpZ2h0ID0gY2FudmFzLmhlaWdodDtcbiAgdGhpcy5zdGF0ZSA9IFwiaWRsZVwiO1xuICB0aGlzLnBvc2l0aW9uID0ge1xuICAgIHg6IHBvc2l0aW9uLngsXG4gICAgeTogcG9zaXRpb24ueVxuICB9O1xuICB0aGlzLnZlbG9jaXR5ID0ge1xuICAgIHg6IDAsXG4gICAgeTogMFxuICB9XG4gIHRoaXMuYW5nbGUgPSAwO1xuICB0aGlzLnJhZGl1cyAgPSA2NDtcbiAgdGhpcy50aHJ1c3RpbmcgPSBmYWxzZTtcbiAgdGhpcy5zdGVlckxlZnQgPSBmYWxzZTtcbiAgdGhpcy5zdGVlclJpZ2h0ID0gZmFsc2U7XG5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB3aW5kb3cub25rZXlkb3duID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBzd2l0Y2goZXZlbnQua2V5KSB7XG4gICAgICBjYXNlICdBcnJvd1VwJzogLy8gdXBcbiAgICAgIGNhc2UgJ3cnOlxuICAgICAgICBzZWxmLnRocnVzdGluZyA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnQXJyb3dMZWZ0JzogLy8gbGVmdFxuICAgICAgY2FzZSAnYSc6XG4gICAgICAgIHNlbGYuc3RlZXJMZWZ0ID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBcnJvd1JpZ2h0JzogLy8gcmlnaHRcbiAgICAgIGNhc2UgJ2QnOlxuICAgICAgICBzZWxmLnN0ZWVyUmlnaHQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICB3aW5kb3cub25rZXl1cCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgc3dpdGNoKGV2ZW50LmtleSkge1xuICAgICAgY2FzZSAnQXJyb3dVcCc6IC8vIHVwXG4gICAgICBjYXNlICd3JzpcbiAgICAgICAgc2VsZi50aHJ1c3RpbmcgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBcnJvd0xlZnQnOiAvLyBsZWZ0XG4gICAgICBjYXNlICdhJzpcbiAgICAgICAgc2VsZi5zdGVlckxlZnQgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBcnJvd1JpZ2h0JzogLy8gcmlnaHRcbiAgICAgIGNhc2UgJ2QnOlxuICAgICAgICBzZWxmLnN0ZWVyUmlnaHQgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59XG5cblBsYXllci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24odGltZSkge1xuICAvLyBBcHBseSBhbmd1bGFyIHZlbG9jaXR5XG4gIGlmKHRoaXMuc3RlZXJMZWZ0KSB7XG4gICAgdGhpcy5hbmdsZSArPSB0aW1lICogMC4wMDU7XG4gIH1cbiAgaWYodGhpcy5zdGVlclJpZ2h0KSB7XG4gICAgdGhpcy5hbmdsZSAtPSAwLjE7XG4gIH1cbiAgLy8gQXBwbHkgYWNjZWxlcmF0aW9uXG4gIGlmKHRoaXMudGhydXN0aW5nKSB7XG4gICAgdmFyIGFjY2VsZXJhdGlvbiA9IHtcbiAgICAgIHg6IE1hdGguc2luKHRoaXMuYW5nbGUpLFxuICAgICAgeTogTWF0aC5jb3ModGhpcy5hbmdsZSlcbiAgICB9XG4gICAgdGhpcy52ZWxvY2l0eS54IC09IGFjY2VsZXJhdGlvbi54O1xuICAgIHRoaXMudmVsb2NpdHkueSAtPSBhY2NlbGVyYXRpb24ueTtcbiAgfVxuICAvLyBBcHBseSB2ZWxvY2l0eVxuICB0aGlzLnBvc2l0aW9uLnggKz0gdGhpcy52ZWxvY2l0eS54O1xuICB0aGlzLnBvc2l0aW9uLnkgKz0gdGhpcy52ZWxvY2l0eS55O1xuICAvLyBXcmFwIGFyb3VuZCB0aGUgc2NyZWVuXG4gIGlmKHRoaXMucG9zaXRpb24ueCA8IDApIHRoaXMucG9zaXRpb24ueCArPSB0aGlzLndvcmxkV2lkdGg7XG4gIGlmKHRoaXMucG9zaXRpb24ueCA+IHRoaXMud29ybGRXaWR0aCkgdGhpcy5wb3NpdGlvbi54IC09IHRoaXMud29ybGRXaWR0aDtcbiAgaWYodGhpcy5wb3NpdGlvbi55IDwgMCkgdGhpcy5wb3NpdGlvbi55ICs9IHRoaXMud29ybGRIZWlnaHQ7XG4gIGlmKHRoaXMucG9zaXRpb24ueSA+IHRoaXMud29ybGRIZWlnaHQpIHRoaXMucG9zaXRpb24ueSAtPSB0aGlzLndvcmxkSGVpZ2h0O1xufVxuXG5QbGF5ZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKHRpbWUsIGN0eCkge1xuICBjdHguc2F2ZSgpO1xuXG4gIC8vIERyYXcgcGxheWVyJ3Mgc2hpcFxuICBjdHgudHJhbnNsYXRlKHRoaXMucG9zaXRpb24ueCwgdGhpcy5wb3NpdGlvbi55KTtcbiAgY3R4LnJvdGF0ZSgtdGhpcy5hbmdsZSk7XG4gIGN0eC5iZWdpblBhdGgoKTtcbiAgY3R4Lm1vdmVUbygwLCAtMTApO1xuICBjdHgubGluZVRvKC0xMCwgMTApO1xuICBjdHgubGluZVRvKDAsIDApO1xuICBjdHgubGluZVRvKDEwLCAxMCk7XG4gIGN0eC5jbG9zZVBhdGgoKTtcbiAgY3R4LnN0cm9rZVN0eWxlID0gJ3doaXRlJztcbiAgY3R4LnN0cm9rZSgpO1xuXG4gIC8vIERyYXcgZW5naW5lIHRocnVzdFxuICBpZih0aGlzLnRocnVzdGluZykge1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgubW92ZVRvKDAsIDIwKTtcbiAgICBjdHgubGluZVRvKDUsIDEwKTtcbiAgICBjdHguYXJjKDAsIDEwLCA1LCAwLCBNYXRoLlBJLCB0cnVlKTtcbiAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gJ29yYW5nZSc7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9XG4gIGN0eC5yZXN0b3JlKCk7XG59XG4iXX0=
